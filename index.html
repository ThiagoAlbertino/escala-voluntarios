<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Escala Voluntariado - Lagoinha Londrina</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="logo-lagoinha.png" type="image/png" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f9fc;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      position: sticky;
      top: 0;
      background: #f7f9fc;
      padding: 15px 0;
      margin: 0 0 20px 0;
      border-bottom: 1px solid #ccc;
      z-index: 100;
      text-align: center;
      font-weight: 700;
    }
    h2, h3 {
      color: #2c3e50;
    }
    input[type="text"], input[type="month"], button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus, input[type="month"]:focus {
      border-color: #4a90e2;
      outline: none;
    }
    button {
      background-color: #4a90e2;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      font-weight: 600;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #357ab8;
    }
    .botoes-grupo {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 30px;
    }
    .botoes-grupo button {
      flex: 1 1 48%;
      min-width: 140px;
    }
    .dia {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      transition: box-shadow 0.3s;
    }
    .dia:hover {
      box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    }
    .turno {
      margin-top: 15px;
      margin-bottom: 10px;
      padding-left: 10px;
    }
    .funcoes-group {
      margin-bottom: 15px;
      padding: 12px;
      border: 1px dashed #bbb;
      border-radius: 8px;
      background-color: #eaf3fc;
    }
    .funcoes-group strong {
      color: #2c3e50;
      font-weight: 600;
    }
    .funcoes {
      margin-left: 15px;
      margin-bottom: 12px;
    }
    .voluntario-checkbox {
      display: inline-block;
      margin-right: 12px;
      margin-top: 8px;
      user-select: none;
      cursor: pointer;
    }
    .voluntario-checkbox input {
      cursor: pointer;
      margin-right: 4px;
    }
    .inativo {
      display: none;
    }
    #resultado, #relatorio {
      white-space: pre-wrap;
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      margin-bottom: 25px;
    }
    #relatorio {
      background: #d9e9ff;
      border-color: #99c2ff;
      color: #164a8a;
      font-weight: 600;
    }
    .label-incluir-culto {
      color: #d64545;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      display: block;
      margin-bottom: 6px;
      font-size: 16px;
    }
    #msgErro {
      color: #d64545;
      font-weight: 700;
      margin-top: -15px;
      margin-bottom: 15px;
      text-align: center;
    }
    @media (max-width: 600px) {
      body { padding: 12px; }
      input, button { font-size: 15px; padding: 10px; }
      .dia { padding: 15px; }
      .voluntario-checkbox { display: block; margin-bottom: 8px; }
      .botoes-grupo {
        flex-direction: column;
      }
      .botoes-grupo button {
        flex: 1 1 100%;
        min-width: auto;
      }
    }

    label.func-transmissao {
        color: #006699;
        font-weight: bold;
    }

  </style>
</head>
<body>

  <h1>üìã Escala Voluntariado FOLLOW Igreja Lagoinha Londrina</h1>

  <label for="mes">Selecione o m√™s:</label>
  <input type="month" id="mes" />

  <label for="voluntarios">Volunt√°rios do V√≠deo <strong>(separados por v√≠rgula)</strong>:</label>
  <textarea
    id="voluntarios"
    placeholder="Amanda, Hugo, Brendha..."
    rows="2"
    style="resize: vertical; width: 100%; font-size: 16px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px;"
  >Amanda, Fernanda, Mari, Thiago</textarea>

  <label for="volFoto">Volunt√°rios da Foto <strong>(separados por v√≠rgula)</strong>:</label>
  <textarea
    id="volFoto"
    placeholder="Somente volunt√°rios da foto..."
    rows="2"
    style="resize: vertical; width: 100%; font-size: 16px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px;"
  >Amanda, Fernanda, Mari, Thiago</textarea>


  <label for="volLive">Volunt√°rios da Live <strong>(separados por v√≠rgula)</strong>:</label>
  <textarea
    id="volLive"
    placeholder="Somente volunt√°rios da live..."
    rows="2"
    style="resize: vertical; width: 100%; font-size: 16px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px;"
  >Brendha, Hugo, Kemelly, Luan, Thiago, Yasmin</textarea>


  <label for="volProj">Volunt√°rios da Proje√ß√£o <strong>(separados por v√≠rgula)</strong>:</label>
  <textarea
    id="volProj"
    placeholder="Somente volunt√°rios da proje√ß√£o..."
    rows="2"
    style="resize: vertical; width: 100%; font-size: 16px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 10px;"
  >Yasmin, Raquel, Vit√≥ria</textarea>


  
  <p id="msgErro"></p>

  <div class="botoes-grupo">
    <button onclick="gerarCampos()">üìÖ Criar Escala do M√™s</button>
    <button onclick="limparFormulario()">üßπ Limpar Escala</button>
  </div>

  <form id="formEscala" style="display:none;"></form>

  <div id="blocoResultado" style="display:none;">
    <h2>üì§ Escala Gerada</h2>
    <div id="relatorio"></div>
    <div id="resultado"></div>
    <button onclick="copiarTexto()">üìã Copiar para WhatsApp</button>
  </div>

  <script>
    let datasCulto = [];
    const funcoesFixas = ["Foto", "V√≠deo", "Live", "Proje√ß√£o"];

    // Carregar volunt√°rios do localStorage
    window.onload = () => {
      const salvos = localStorage.getItem("voluntarios");
      const projSalvos = localStorage.getItem("volProj");
      const liveSalvos = localStorage.getItem("volLive");
      if (salvos) document.getElementById("voluntarios").value = salvos;
      if (projSalvos) document.getElementById("volProj").value = projSalvos;
      if (liveSalvos) document.getElementById("volLive").value = liveSalvos;
      const fotoSalvos = localStorage.getItem("volFoto");
      if (fotoSalvos) document.getElementById("volFoto").value = fotoSalvos;
    };



    // Salvar volunt√°rios no localStorage conforme digita
    document.getElementById("voluntarios").addEventListener("input", () => {
      localStorage.setItem("voluntarios", document.getElementById("voluntarios").value);
    });

    const nomesCultos = {
      0: { nome: "Culto de Celebra√ß√£o", turnos: ["Manh√£", "Noite"] },
      2: { nome: "Culto Rocket", turnos: ["√önico"] },
      3: { nome: "Culto F√©", turnos: ["√önico"] },
      6: { nome: "Culto Legacy", turnos: ["√önico"] }
    };

    function gerarCampos() {
  document.getElementById("msgErro").textContent = "";
  const mesInput = document.getElementById("mes").value;
  const voluntarios = document
    .getElementById("voluntarios")
    .value.split(",")
    .map((v) => v.trim())
    .filter((v) => v);

  if (!mesInput || voluntarios.length === 0) {
    document.getElementById("msgErro").textContent = "‚ö†Ô∏è Preencha todos os campos!";
    return;
  }

  const form = document.getElementById("formEscala");

  // Corre√ß√£o aqui: parse do ano e m√™s com valores reais
  const [anoStr, mesStr] = mesInput.split("-");
  const ano = parseInt(anoStr, 10);
  const mes = parseInt(mesStr, 10); // m√™s 1 a 12
  const diasNoMes = new Date(ano, mes, 0).getDate(); // passa m√™s como est√° (j√° que JS usa 0-11 internamente)
  datasCulto = [];

  for (let dia = 1; dia <= diasNoMes; dia++) {
    const d = new Date(ano, mes - 1, dia); // aqui sim subtrai 1 para usar no Date()
    if ([0, 2, 3, 6].includes(d.getDay())) {
      datasCulto.push(d);
    }
  }

  form.innerHTML = `<h2>üóìÔ∏è Selecione os cultos e volunt√°rios</h2>`;

  datasCulto.forEach((d, idx) => {
    const diaSemana = d.getDay();
    const infoCulto = nomesCultos[diaSemana];
    const dataStr = d.toLocaleDateString("pt-BR");
    let bloco = `<div class="dia"><h3>${dataStr} - ${infoCulto.nome}</h3>`;

    if (diaSemana === 0) {
      infoCulto.turnos.forEach((turno) => {
        const turnoId = `turno_${idx}_${turno}`.replace(/\s+/g, "_");
        bloco += `
          <label class="label-incluir-culto" for="${turnoId}_ativo">
            <input type="checkbox" id="${turnoId}_ativo" onchange="toggleTurno('${turnoId}')">
            Incluir culto ${turno.toLowerCase()}
          </label>
          <div id="${turnoId}_bloco" class="turno inativo">`;
        bloco += gerarFuncoes(voluntarios, idx, turno);
        bloco += `</div>`;
      });
    } else {
      const unicoId = `culto_${idx}`;
      bloco += `
        <label class="label-incluir-culto" for="${unicoId}_ativo">
          <input type="checkbox" id="${unicoId}_ativo" onchange="toggleTurno('${unicoId}')">
          Incluir culto
        </label>
        <div id="${unicoId}_bloco" class="turno inativo">`;
      bloco += gerarFuncoes(voluntarios, idx, "√önico");
      bloco += `</div>`;
    }

    bloco += `</div>`;
    form.innerHTML += bloco;
  });

  form.innerHTML += `<button type="button" onclick="gerarTexto()">‚úÖ Gerar Texto da Escala</button>`;
  form.style.display = "block";
  document.getElementById("blocoResultado").style.display = "none";

  window.scrollTo({ top: form.offsetTop, behavior: "smooth" });
}

    function gerarFuncoes(voluntarios, idx, turno) {
    const grupos = [
      { nome: "üì∑ Volunt√°rios Foto e V√≠deo", cor: "orange", funcoes: ["Foto", "V√≠deo"] },
      { nome: "üìΩÔ∏è Volunt√°rios Proje√ß√£o e Live", cor: "green", funcoes: ["Live", "Proje√ß√£o"] }
    ];

    const voluntariosProjecao = document.getElementById("volProj").value
      .split(",").map(v => v.trim()).filter(v => v);
    const voluntariosLive = document.getElementById("volLive").value
      .split(",").map(v => v.trim()).filter(v => v);

     const voluntariosFoto = document.getElementById("volFoto")?.value
    .split(",").map(v => v.trim()).filter(v => v) || [];


    let html = "";
    grupos.forEach((grupo) => {
      html += `<div class='funcoes-group' style="border-left: 5px solid ${grupo.cor};"><strong>${grupo.nome}</strong><br>`;
      grupo.funcoes.forEach((func) => {
        const classeFunc = (func === "Live" || func === "Proje√ß√£o") ? "func-transmissao" : "";
        html += `<label class="${classeFunc}">${func}:</label><div class="funcoes">`;

        let lista = voluntarios;
        if (func === "Proje√ß√£o") lista = voluntariosProjecao;
        else if (func === "Live") lista = voluntariosLive;
        else if (func === "Foto") lista = voluntariosFoto;

        lista.forEach((v) => {
          const id = `chk_${idx}_${turno}_${func}_${v}`.replace(/\s+/g, "_");
          html += `
            <label class="voluntario-checkbox" for="${id}">
              <input type="checkbox" id="${id}" name="${id}" data-dia="${idx}" data-turno="${turno}" data-func="${func}" value="${v}" onchange="atualizarRestricoes(${idx}, '${turno}', '${v}')">
              ${v}
            </label>`;
        });

        html += `</div>`;
      });
      html += `</div>`;
    });
    return html;
  }



    function toggleTurno(turnoId) {
      const checkbox = document.getElementById(`${turnoId}_ativo`);
      const bloco = document.getElementById(`${turnoId}_bloco`);
      bloco.classList.toggle("inativo", !checkbox.checked);
    }

    function atualizarRestricoes(idx, turno, voluntario) {
      const inputs = document.querySelectorAll(
        `input[data-dia='${idx}'][data-turno='${turno}'][value='${voluntario}']`
      );
      let marcado = false;
      inputs.forEach((inp) => {
        if (inp.checked) marcado = true;
      });
      inputs.forEach((inp) => {
        if (!inp.checked) inp.disabled = marcado;
        else inp.disabled = false;
      });
    }

    function gerarTexto() {
  const mesInput = document.getElementById("mes").value;
  if (!mesInput) {
    document.getElementById("msgErro").textContent = "‚ö†Ô∏è Selecione um m√™s antes de gerar a escala.";
    return;
  }
  document.getElementById("msgErro").textContent = "";

  // Corrigido: for√ßa cria√ß√£o da data com dia 1, m√™s e ano extra√≠dos do input
  const [anoStr, mesStr] = mesInput.split("-");
  const ano = parseInt(anoStr, 10);
  const mes = parseInt(mesStr, 10); // 1 a 12
  const dataReferencia = new Date(ano, mes - 1, 1);

  const textoMes = dataReferencia.toLocaleDateString("pt-BR", {
    month: "long",
    year: "numeric"
  });

  let texto = `üìÖ Escala - ${textoMes}\n\n`;
  const contagem = {};

  datasCulto.forEach((d, idx) => {
    const diaSemana = d.getDay();
    const infoCulto = nomesCultos[diaSemana];
    const dataStr = d.toLocaleDateString("pt-BR");

    if (diaSemana === 0) {
      infoCulto.turnos.forEach((turno) => {
        const turnoId = `turno_${idx}_${turno}`.replace(/\s+/g, "_");
        const isAtivo = document.getElementById(`${turnoId}_ativo`).checked;
        if (!isAtivo) return;

        let blocoTurno = `${turno}:\n`;
        let temConteudo = false;

        funcoesFixas.forEach((func) => {
          const checkboxes = document.querySelectorAll(
            `input[data-dia='${idx}'][data-turno='${turno}'][data-func='${func}']:checked`
          );
          if (checkboxes.length > 0) {
            const nomes = Array.from(checkboxes).map((cb) => cb.value);
            blocoTurno += `- ${func}: ${nomes.join(", ")}\n`;
            nomes.forEach((nome) => {
              contagem[nome] = (contagem[nome] || 0) + 1;
            });
            temConteudo = true;
          }
        });

        if (temConteudo) {
          texto += `üóìÔ∏è ${infoCulto.nome} - ${dataStr}\n${blocoTurno}\n`;
        }
      });
    } else {
      const unicoId = `culto_${idx}`;
      const isAtivo = document.getElementById(`${unicoId}_ativo`).checked;
      if (!isAtivo) return;

      let blocoCulto = "";
      let temConteudo = false;

      funcoesFixas.forEach((func) => {
        const checkboxes = document.querySelectorAll(
          `input[data-dia='${idx}'][data-turno='√önico'][data-func='${func}']:checked`
        );
        if (checkboxes.length > 0) {
          const nomes = Array.from(checkboxes).map((cb) => cb.value);
          blocoCulto += `- ${func}: ${nomes.join(", ")}\n`;
          nomes.forEach((nome) => {
            contagem[nome] = (contagem[nome] || 0) + 1;
          });
          temConteudo = true;
        }
      });

      if (temConteudo) {
        texto += `üóìÔ∏è ${infoCulto.nome} - ${dataStr}\n${blocoCulto}\n`;
      }
    }
  });

  let relatorio = "üìä Relat√≥rio de Volunt√°rios:\n";
  Object.entries(contagem)
    .sort((a, b) => b[1] - a[1])
    .forEach(([nome, qtd]) => {
      relatorio += `- ${nome}: ${qtd} vez(es)\n`;
    });

  document.getElementById("relatorio").textContent = relatorio.trim();
  document.getElementById("resultado").textContent = texto.trim() || "Nenhum culto preenchido.";
  document.getElementById("blocoResultado").style.display = "block";
  window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
}


    document.getElementById("voluntarios").addEventListener("input", () => {
      localStorage.setItem("voluntarios", document.getElementById("voluntarios").value);
    });
    document.getElementById("volProj").addEventListener("input", () => {
      localStorage.setItem("volProj", document.getElementById("volProj").value);
    });
    document.getElementById("volLive").addEventListener("input", () => {
      localStorage.setItem("volLive", document.getElementById("volLive").value);
    });
    document.getElementById("volFoto").addEventListener("input", () => {
      localStorage.setItem("volFoto", document.getElementById("volFoto").value);
    });


    function copiarTexto() {
      const texto = `${document.getElementById("relatorio").textContent}\n\n${document.getElementById("resultado").textContent}`;
      navigator.clipboard.writeText(texto).then(() => {
        alert("‚úÖ Texto copiado! Cole no WhatsApp.");
      });
    }
  </script>
</body>
</html>
